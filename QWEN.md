# Sea Patrol Frontend

## Обзор проекта

**Sea Patrol** — это многопользовательская 3D-браузерная игра про парусные корабли, построенная на **React**, **Three.js** и **React Three Fiber (R3F)**. Игроки могут регистрироваться/входить в систему, управлять парусными кораблями в 3D-океане и взаимодействовать с другими игроками в реальном времени через WebSocket-соединения.

### Технологический стек

| Категория | Технология |
|-----------|------------|
| **Фреймворк** | React 19 |
| **Инструмент сборки** | Vite 7 |
| **3D-графика** | Three.js + React Three Fiber + Drei |
| **Роутинг** | React Router DOM |
| **Управление состоянием** | React Context API |
| **Общение в реальном времени** | WebSocket |
| **Debug UI** | Leva |
| **Мониторинг производительности** | r3f-perf |
| **PWA** | vite-plugin-pwa |

### Архитектура

```
src/
├── components/       # React-компоненты (3D-объекты, UI-элементы)
│   ├── PlayerSailShip.jsx    # Корабль игрока с интерполяцией
│   ├── NpcSailShip.jsx       # Корабли NPC
│   ├── Ocean.jsx             # Рендеринг океана
│   ├── GameMainScene.jsx     # Основная 3D-сцена
│   ├── ChatBlock.jsx         # UI чата
│   └── ...
├── contexts/         # Провайдеры React Context
│   ├── AuthContext.jsx       # Состояние аутентификации
│   ├── WebSocketContext.jsx  # WebSocket-соединение и pub/sub
│   └── GameStateContext.jsx  # Глобальное состояние игры (позиции игроков и т.д.)
├── pages/            # Страницы роутинга
│   ├── HomePage.jsx          # Главная страница с аутентификацией
│   └── GamePage.jsx          # Основная игровая страница
├── const/            # Константы
│   └── messageType.js        # Типы WebSocket-сообщений
├── utils/            # Вспомогательные функции
│   └── models.js             # Утилиты загрузки 3D-моделей
├── styles/           # CSS-стили
├── assets/           # Статические ресурсы (3D-модели, изображения)
├── App.jsx           # Основное приложение с роутингом
└── main.jsx          # Точка входа
```

### Ключевые возможности

- **Аутентификация**: Система входа/регистрации с JWT-токенами (backend: `http://localhost:8080`)
- **Многопользовательский режим в реальном времени**: Синхронизация позиций и действий игроков через WebSocket
- **Управление кораблём в 3D**: Клавиши WASD/стрелки для навигации корабля
- **Клиентское предсказание**: Плавная интерполяция между обновлениями состояния сервера
- **Поддержка PWA**: Офлайн-кэширование ресурсов, включая 3D-модели (`.glb` файлы)

---

## Сборка и запуск

### Предварительные требования

- Node.js (рекомендуется последняя LTS-версия)
- npm

### Установка

```bash
npm install
```

### Сервер разработки

```bash
npm run dev
```

Приложение доступно по адресу `http://localhost:5173` (по умолчанию Vite).

### Продакшен-сборка

```bash
npm run build
```

Результат: директория `dist/`.

### Предпросмотр продакшен-сборки

```bash
npm run preview
```

### Линтинг

```bash
npm run lint
```

---

## Интеграция с бэкендом

Фронтенд ожидает backend-сервер по адресу `http://localhost:8080`:

| Endpoint | Протокол | Назначение |
|----------|----------|------------|
| `/api/v1/auth/login` | HTTP POST | Аутентификация пользователя |
| `/api/v1/auth/signup` | HTTP POST | Регистрация пользователя |
| `/ws/game` | WebSocket | Синхронизация состояния игры в реальном времени |

### Типы WebSocket-сообщений (`src/const/messageType.js`)

- `CHAT_MESSAGE`, `CHAT_JOIN`, `CHAT_LEAVE` — события чата
- `PLAYER_INPUT`, `PLAYER_JOIN`, `PLAYER_LEAVE` — события игроков
- `INIT_GAME_STATE`, `UPDATE_GAME_STATE` — синхронизация состояния игры

---

## Конвенции разработки

### Стиль кода

- **ESLint**: Настроен в `eslint.config.js`:
  - Рекомендуемые правила `@eslint/js`
  - `eslint-plugin-react-hooks` для лучших практик работы с хуками
  - `eslint-plugin-react-refresh` для Vite React Refresh
  - Неиспользуемые переменные, начинающиеся с `A-Z` или `_`, разрешены (для JSX-компонентов)

### Именование файлов

- Компоненты: **PascalCase** (например, `PlayerSailShip.jsx`)
- Утилиты/Константы: **camelCase** (например, `messageType.js`, `models.js`)
- Стили: **PascalCase** в соответствии с именем компонента (например, `HomePage.css`)

### Управление состоянием

- **Context API** для глобального состояния (Auth, WebSocket, GameState)
- `useRef` для изменяемого состояния игры, которое не требует перерендера
- Кастомные хуки: `useAuth()`, `useWebSocket()`, `useGameState()`

### 3D-ресурсы

- Модели хранятся в `src/assets/` (формат `.glb`)
- Предзагрузка через `useGLTF.preload()` в `src/utils/models.js`
- Vite настроен на обработку файлов `.glb`/`.gltf` через `assetsInclude`

### Инструменты отладки

- **Leva**: Внутриигровые debug-контролы (позиция корабля, положение солнца, физика)
- **r3f-perf**: Монитор производительности (оверлей в левом верхнем углу)

---

## Структура проекта

| Директория | Назначение |
|------------|------------|
| `src/components/` | Переиспользуемые UI и 3D-компоненты |
| `src/contexts/` | Провайдеры глобального состояния |
| `src/pages/` | Компоненты уровней маршрутизации |
| `src/styles/` | CSS-файлы для компонентов/страниц |
| `src/assets/` | 3D-модели, изображения, шрифты |
| `src/utils/` | Вспомогательные функции (загрузка моделей) |
| `src/const/` | Константы приложения |
| `public/` | Статические публичные ресурсы |
| `dist/` | Результат продакшен-сборки |

---

## Ключевые файлы конфигурации

| Файл | Назначение |
|------|------------|
| `vite.config.js` | Конфигурация сборки Vite, PWA-плагин, обработка ресурсов |
| `eslint.config.js` | Правила ESLint для React/JSX |
| `package.json` | Зависимости и npm-скрипты |
| `index.html` | HTML-точка входа |
